// Generated by CoffeeScript 1.6.3
var EventEmitter, PhraseRunner;

EventEmitter = require('events').EventEmitter;

PhraseRunner = require('./phrase/phrase_runner');

exports.create = function(root) {
  var context, emitter, graph, notice;
  context = root.context;
  graph = context.graph, notice = context.notice;
  emitter = new EventEmitter;
  emitter.graph = graph;
  emitter.run = function(opts) {
    if (opts == null) {
      opts = {};
    }
    return PhraseRunner.run(root, opts);
  };
  notice.use(function(msg, next) {
    if (msg.context.title === 'phrase::recurse:end') {
      if (msg.walk.first) {
        emitter.emit('ready', {
          walk: msg.walk,
          tokens: msg.tokens
        });
      }
    }
    return next();
  });
  return emitter;
};
