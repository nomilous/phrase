// Generated by CoffeeScript 1.6.3
exports.create = function(root) {
  var api, children, edges, leaves, parent, tree, vertices;
  vertices = {};
  edges = {};
  parent = {};
  children = {};
  leaves = [];
  tree = {
    leaves: {}
  };
  api = {
    assembler: function(msg, next) {
      if (msg.context.title === 'phrase::edge:create') {
        return api.registerEdge(msg, next);
      } else if (msg.context.title === 'phrase::leaf:create') {
        return api.registerLeaf(msg, next);
      } else {
        return next();
      }
    },
    registerEdge: function(msg, next) {
      var vertex1, vertex2, _name, _name1, _name2, _ref;
      _ref = msg.vertices, vertex1 = _ref[0], vertex2 = _ref[1];
      if (!vertex2) {
        return next();
      }
      vertices[vertex1.uuid] = vertex1;
      vertices[vertex2.uuid] = vertex2;
      edges[_name = vertex1.uuid] || (edges[_name] = []);
      edges[vertex1.uuid].push({
        connect: vertex2.uuid
      });
      edges[_name1 = vertex2.uuid] || (edges[_name1] = []);
      edges[vertex2.uuid].push({
        connect: vertex1.uuid
      });
      if (msg.type === 'tree') {
        parent[vertex2.uuid] = vertex1.uuid;
        children[_name2 = vertex1.uuid] || (children[_name2] = []);
        children[vertex1.uuid].push(vertex2.uuid);
        if (vertex2.leaf) {
          leaves.push(vertex2.uuid);
        }
      }
      return next();
    },
    registerLeaf: function(msg, next) {
      tree.leaves[msg.uuid] = msg;
      return next();
    }
  };
  Object.defineProperty(api, 'vertices', {
    enumerable: true,
    get: function() {
      return vertices;
    }
  });
  Object.defineProperty(api, 'edges', {
    enumerable: true,
    get: function() {
      return edges;
    }
  });
  Object.defineProperty(api, 'parent', {
    enumerable: true,
    get: function() {
      return parent;
    }
  });
  Object.defineProperty(api, 'children', {
    enumerable: true,
    get: function() {
      return children;
    }
  });
  Object.defineProperty(api, 'leaves', {
    enumerable: true,
    get: function() {
      return leaves;
    }
  });
  return Object.defineProperty(api, 'tree', {
    enumerable: true,
    get: function() {
      return tree;
    }
  });
};
