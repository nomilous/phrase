#! /usr/bin/env coffee

phrase = require( '../lib/phrase' ).createRoot
    
    title: 'Title'
    uuid:  'UUID'

    (token, notice) -> 

        token.on 'ready', ({tokens}) -> 

            # console.log TOKENS: tokens

            token.run( uuid: 'UUID', 

                parameter1: 'parameter1'
                parameter2: 'parameter2'

            ).then( 

                (result) -> 

                    console.log RESULT_1: result

                    #
                    # reload the phrase tree
                    #

                    phrase 'root phrase title', (nested) -> 
                        nested 'nested phrase title', (end) -> 
                            console.log """
                            

                            running REPLACED phrase title with #{@parameter1} and #{@parameter2}
                            """
                            @updatedResultData = 1
                            end()

                (error) -> 

                    console.log error.stack
            )


        token.on 'changed', (pending) -> 

            #
            # re-run on changed 
            #

            token.run( uuid: 'UUID',

                parameter1: 'parameter1'
                parameter2: 'parameter2'

            ).then (result) -> 

                console.log RESULT_2: result
                console.log CHANGE_SET_CURRENTLY_BROKEN: true
            



promise = phrase 'root phrase title', (nested) -> 

    nested 'nested phrase title', (end) -> 

        console.log """
        

        running ORIGINAL phrase title with #{@parameter1} and #{@parameter2}
        """
        @originalResult = 1
        end()


promise.then(

    (result) -> #console.log RESULT: result 
    (error)  -> console.log error.stack
    (notify) -> #console.log NOTIFY: notify

)
